let forceUpdateList=[];const reRender=()=>{requestAnimationFrame(()=>{for(let{component:e,resolve:t}of forceUpdateList)e&&e.forceUpdate&&e.forceUpdate(t);forceUpdateList=[]})},RCheatState=(e,t,o)=>{let n={},r=e,c={};function a(e){return r!=e?(r=e,new Promise(e=>{for(let t in n){let o=forceUpdateList.filter(e=>e.component_key==t)[0];o?c[o.component_key].push(e):(c[t]=c[t]||[e],forceUpdateList.push({component_key:t,component:n[t],resolve(){for(let e of c[t])e(r)}}))}reRender()})):new Promise(e=>e(r))}let _={components:n,onDelete:()=>{}};function l(e){if(n[e.___rcheat_component_key])return r;if(e.___rcheat_component_key||Object.defineProperty(e,"___rcheat_component_key",{value:Math.random(),writable:!1}),0==Object.keys(n).length){let e="function"==typeof t&&t(a);_.onDelete=function(){0==Object.keys(n).length&&("function"==typeof e&&e(),_.onDelete=(()=>{}))}}return n[e.___rcheat_component_key]=e,r}return all_components.push(_),o&&(l.set=(e=>a(e))),l.get=(()=>r),l};let all_components=[];function RCheatUnmount(e){for(let{components:t,onDelete:o}of all_components)t[e.___rcheat_component_key]&&(delete t[e.___rcheat_component_key],o())}export const readable=(e,t)=>RCheatState(e,t,!1);export const writable=(e,t)=>RCheatState(e,t,!0);export const unmount=e=>RCheatUnmount(e);const RCS={readable:readable,writable:writable,unmount:unmount};export default RCS;